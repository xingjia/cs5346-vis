<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="echarts.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>

<body >
    <div id="selection">
        <div>Choose a topic:</div>
    </div>
    <div id="main" style="width: 1000px; height:400px;"></div>

    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));

        var colors = ["balck", "#ffcce1", "#6ab4ed", "#f484ab", "#ff9b7a", "#97f287"]

        var years = []

        for (var x = 0; x < 10; x++) {
            years.push(1990 + x)
        }


        $.get('topicModel.json').done(function(data) {

            var topicNames = []

            for (var topic in data) {
                topicNames.push(topic)

            }

            topicNames.map(function(topic) {
                var topicButton = $("<button></button>");
                topicButton.text(topic);
                topicButton.css({
                    "margin": "5px", 
                    "padding": "5px", 
                    "background": "white",
                    "border": "1px solid grey"
                    });
                topicButton.on("click", showChart.bind(this, data[topic]))
                $("#selection").append(topicButton);
            });
        });

        function showChart(data) {
            var keywords = []
            var calcData = []
            for (var keyword in data) {
                var kIdx = keywords.length;
                keywords.push(keyword)

                for (var yearIdx in data[keyword]) {
                    calcData.push([parseInt(yearIdx), kIdx, data[keyword][yearIdx]]);
                }
            }

            myChart.setOption({
                title: {
                    left: 'center',
                    text: 'Keyword Popularity in Topic'
                },
                legend: {
                    data: ['Popularity'],
                    left: 'right'
                },
                grid: {
                    x: 200
                },
                tooltip: {
                    formatter: function(params, callback) {
                        console.log(params)
                        return "Keyword: " + keywords[params.data[0]] + "<br>" +
                                "Year: " + years[params.data[1]] + "<br>" + 
                                "Value: " + params.data[2];
                    }
                },
                xAxis: {
                    type: 'category',
                    data: years,
                    boundaryGap: false,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#999',
                            type: 'dashed'
                        }
                    },
                    axisLine: {
                        show: false
                    }
                },
                yAxis: {
                    type: 'category',
                    data: keywords,
                    axisLine: {
                        show: false
                    },
                    axisLabel: {
                        margin: 20
                    }
                },
                series: [{
                    name: 'Popularity',
                    type: 'scatter',
                    symbolSize: function (val) {
                        return val[2] * 2000;
                    },
                    data: calcData
                }]
            })
        }
            



       
    </script>
</body>

</html>

